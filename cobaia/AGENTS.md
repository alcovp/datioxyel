# ТЗ: Ray Tracer (развитие по-взрослому)

## Базовый принцип
- Развиваем рендерер итеративно и инженерно строго.
- Не подгоняем ТЗ под временные костыли реализации.
- Контракты (capabilities) обязаны точно соответствовать фактическим возможностям движка.
- Архитектура должна упрощать добавление новых сцен, материалов и световых моделей.

## Цель
Собрать офлайн-рендерер, который запускается из CLI, рендерит кадры на диск и масштабируется от MVP до физически более корректного трассера лучей.

## Формат запуска
- Запуск через CLI-скрипт.
- Поддерживаются:
- один кадр (single frame),
- пакет кадров (batch).
- После сохранения всех целевых изображений процесс завершается.

## Архитектурные требования
- Четко разделяем:
- `renderer` (возможности, ограничения, настройки, пайплайн),
- `scene` (объекты, материалы, источники света),
- `view/camera` (параметры кадра и ракурса),
- orchestration слой CLI.
- Материалы определяются в сцене как данные, а не хардкодятся в шейдере.
- Любой рендерный флаг в capabilities отражает только реально реализованную функциональность.

## Требуемые возможности рендера
- 3D-сцена.
- Источники света в сцене.
- Отражения.
- Прозрачные материалы с физически осмысленной рефракцией:
- закон Снеллиуса,
- Fresnel/Schlick,
- Total Internal Reflection (TIR).
- Ограничение глубины трассировки должно быть настраиваемым параметром кадра.

## Сцены
- Сцены не фиксируются в ТЗ как одна "жестко заданная" конфигурация.
- Архитектура должна поддерживать добавление новых сцен без переписывания ядра рендера.
- Каждая сцена задает собственные:
- объекты,
- материалы (включая цвет и оптические свойства),
- источники света,
- параметры камеры/ракурса.
- Для демонстрационных пресетов допускаются сцены с губкой Менгера, полом и directional light, но это не единственный разрешенный вариант.

## Технологический стек
- Node.js + TypeScript: CLI, сценарии запуска, управление пайплайном.
- Rust: вычислительное ядро рендера.

## Roadmap развития
- Этап 1: стабильная архитектура сцена/рендерер/view/materials/lights.
- Этап 2: корректная материал-модель без shader hardcode.
- Этап 3: полноценная стеклянная рефракция (Snell + Fresnel + TIR).
- Этап 4: повышение качества и производительности (sampling, шум, параллелизм, оптимизации).

## Критерий готовности ближайшего этапа
- Скрипт рендера воспроизводимо генерирует изображения на диск.
- Для стеклянных материалов визуально присутствует корректная рефракция и отражение.
- Возможности рендера в коде (`capabilities`) синхронизированы с реальной реализацией.
